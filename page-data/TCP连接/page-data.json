{"componentChunkName":"component---src-templates-blog-post-js","path":"/TCP连接/","result":{"data":{"site":{"siteMetadata":{"title":"feiker的小站"}},"markdownRemark":{"id":"23419b24-beb0-5d2a-b57f-8fe3d57242a9","excerpt":"TCP 三次握手为什么是 3 次而不是 2 次或者 4 次 TCP 协议是什么，为什么需要 TCP 要搞懂为什么是三次握手，首先得搞懂什么是 TCP 协议，为什么网络协议中需要 TCP 协议。 传输控制协议（英语：Transmission Control Protocol，缩写：TCP…","html":"<h2>TCP 三次握手为什么是 3 次而不是 2 次或者 4 次</h2>\n<h3>TCP 协议是什么，为什么需要 TCP</h3>\n<p>要搞懂为什么是三次握手，首先得搞懂什么是 TCP 协议，为什么网络协议中需要 TCP 协议。</p>\n<p><strong>传输控制协议</strong>（英语：<strong>T</strong>ransmission <strong>C</strong>ontrol <strong>P</strong>rotocol，缩写：<strong>TCP</strong>）是一种面向连接的、可靠的、基于<a href=\"https://zh.wikipedia.org/wiki/%E5%AD%97%E7%AF%80%E6%B5%81\">字节流</a>的<a href=\"https://zh.wikipedia.org/wiki/%E4%BC%A0%E8%BE%93%E5%B1%82\">传输层</a>通信协议，由<a href=\"https://zh.wikipedia.org/wiki/IETF\">IETF</a>的<a href=\"https://zh.wikipedia.org/wiki/RFC\">RFC</a> <a href=\"https://tools.ietf.org/html/rfc793\">793</a>定义。在简化的计算机网络<a href=\"https://zh.wikipedia.org/wiki/OSI%E6%A8%A1%E5%9E%8B\">OSI 模型</a>中，它完成第四层传输层所指定的功能。<a href=\"https://zh.wikipedia.org/wiki/%E7%94%A8%E6%88%B7%E6%95%B0%E6%8D%AE%E6%8A%A5%E5%8D%8F%E8%AE%AE\">用户数据报协议</a>（UDP）是同一层内另一个重要的传输协议。</p>\n<p>在网络协议中，TCP 位与 IP 层之上，应用层之下，与 UDP 不同的是，TCP 需要保证在数据传输过程中不丢失，以及数据到达之后精确，可靠，而不是被篡改。</p>\n<p>注意这里，数据的可靠与精确，这个是 TCP 协议需要保证的最基本功能。</p>\n<h3>TCP 三次握手的具体流程</h3>\n<p>TCP 协议的运行可划分为三个阶段：连接创建(<em>connection establishment</em>)、数据传送（<em>data transfer</em>）和连接终止（<em>connection termination</em>）</p>\n<p>我们说的 TCP 三次握手是 TCP 客户端和服务端连接创建时候的工作。</p>\n<p>以下是 TCP 连接的具体流程，</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/blog/static/78497aa3a48de28d29a88d46b92e496b/1478c/tcp.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 63.96396396396396%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAA9hAAAPYQGoP6dpAAACVUlEQVQoz01SaXOiQBT0//+JzcdNVaJxc5QohxpBEAQcjgEEwWCIJWoCVBKNHPvU3VS6qGF4Q8/0dL9aWVb73W4kCGG4OOT5fr8viqL6gbIsv76+yrKIomdJktbrDRTzPC+KvEbTNElSoiiqqmpirOt6EATfNBg3mw1wTNNUVYXneYqiu91er9ffbre1ev3q/v7WtrHruo7j2LYNk5/k1WoFxeVyGUVRGIYMTTfq1xRJZFla47jeRJU0bQLbK4oylmXXm/4kr9fru9tbkiTb7bZlWYoidnsdVRXTNK3BN0hiWbbVasEfBEFomp3nVZpky5f4dHJMU9Tj46MgCEHgi7RJXY9ExkiTpMbzEkIGNjHw+eFwNBLUiZNllePEoni8fBzHg8HAMAyQpuuGoWk8x2JTP8q+uGhd/mbAJ4TQkOP6/b5lYXDycMjfko+3pJKkVbPZBFEgTdM0P/A1XYuWL1mW1RBSbAcH8wDMUmQZbLQcDAfOrHDMGtW+mltxp90esCxYPEGIaPSufj0QDSYB2VjHwSzAJ4DXU3dqo9n+tdo+7ePgo9iBYTGkOJvNplMXUkQqEjgBxB8Na3NEV+pyQ5YbDps3N3cPdzzjfKTVW5KEi+XZ7Xr9utPpyLLseR7I1k09fF4cZTfYyz/cleUYT/Mn5wTsuJ+7yp1ux+PFOefJZBJ8w/WRghbzEzkKIfvoVPbn8zm8PO9fkxzy8v29ksQ12SEhJ47jPNdjVOZm0OiqzNFtbGF4LNuyT4Cb+77/v0mKs2xonvMSjBRP3A8aFP/w+rr9C4dcm3aPuunxAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"tcp\"\n        title=\"tcp\"\n        src=\"/blog/static/78497aa3a48de28d29a88d46b92e496b/b9e4f/tcp.png\"\n        srcset=\"/blog/static/78497aa3a48de28d29a88d46b92e496b/cf440/tcp.png 148w,\n/blog/static/78497aa3a48de28d29a88d46b92e496b/d2d38/tcp.png 295w,\n/blog/static/78497aa3a48de28d29a88d46b92e496b/b9e4f/tcp.png 590w,\n/blog/static/78497aa3a48de28d29a88d46b92e496b/1478c/tcp.png 666w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<ol>\n<li>客户端 client 向服务端 server 发送一个 SYN(synchronize)报，包上带随机序号 A</li>\n<li>server 接收到 client 的 SYN 初始化包之后，回复一个 SYN/ACK 包，ACK 包上带上序号 A+1，表示我正确收到了这个客户端 client 的消息，同时自己的 SYN 上带上随机序号 B</li>\n<li>client 收到 server 的 SYN/ACK 包后，回复一个 ACK 包，带上序号 B+1，告诉客户端我们我正确接收到你的请求</li>\n</ol>\n<p>了解以上流程之后，我们再来回答为什么是 3 次，而不是 2 次或者 4 次。</p>\n<h5>为什么不是 2 次</h5>\n<p>如果只有 2 次，那么能做的只有</p>\n<ol>\n<li>client 向 server 发送一个连接请求，SYN 带上随机数 A</li>\n<li>server 回复 ACK/SYN，ACK 带上 A+1，SYN 带上自己的随机数 B</li>\n</ol>\n<p>以上保证了 client 向 server 发送请求的准确性，如果 server 发送的 ACK/SYN 包丢失，那么 server 向 client 发送消息的初始序号 B 就无法同步</p>\n<h5>为什么不是 4 次</h5>\n<p>以上第二次的 ACK/SYN 包可以被拆分成两个 ACK 包和 SYN 包两次发送，但是没必要，就比如以下对话</p>\n<ol>\n<li>how are you</li>\n<li>I’m fine, thanks, and you\u0010?</li>\n</ol>\n<p>I’m fine 的回应和 and you 完全可以放到同一个消息里，没必要拆分。</p>\n<h4>参考</h4>\n<p><a href=\"https://zh.wikipedia.org/wiki/%E4%BC%A0%E8%BE%93%E6%8E%A7%E5%88%B6%E5%8D%8F%E8%AE%AE\">维基百科: TCP</a>\n<a href=\"https://www.zhihu.com/question/24853633\">知乎: TCP 为什么是三次握手，而不是两次或者四次</a></p>","frontmatter":{"title":"tcp三次握手","date":"November 21, 2019","description":"tcp三次握手具体流程，为什么是3次而不是2次或者4次"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/TCP连接/","previous":{"fields":{"slug":"/the-art-of-command-line/"},"frontmatter":{"title":"the art of cammand line"}},"next":{"fields":{"slug":"/jwt鉴权/"},"frontmatter":{"title":"前后端分离下的cas"}}}}}