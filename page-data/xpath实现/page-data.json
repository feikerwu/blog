{"componentChunkName":"component---src-templates-blog-post-js","path":"/xpath实现/","result":{"data":{"site":{"siteMetadata":{"title":"feiker的小站"}},"markdownRemark":{"id":"d0ca995e-57d4-54da-9c10-46abacda625e","excerpt":"XPath 即为 XML 路径语言（XML Path Language），它是一种用来确定 XML 文档中某部分位置的计算机语言。 DOM 中的 xpath 通常用作唯一 id，用来标识 dom 元素在页面中的位置，用于以下功能 爬虫 dom 元素定位 可视化埋点 dom 节点标示 以下是 xpath 和 css…","html":"<p>XPath 即为 XML 路径语言（XML Path Language），它是一种用来确定 XML 文档中某部分位置的计算机语言。</p>\n<p>DOM 中的 xpath 通常用作唯一 id，用来标识 dom 元素在页面中的位置，用于以下功能</p>\n<ol>\n<li>爬虫 dom 元素定位</li>\n<li>可视化埋点 dom 节点标示</li>\n</ol>\n<p>以下是 xpath 和 css selector 的实现</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token comment\">/**\n * 获取某个dom的xpath\n * @param target dom 节点\n */</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> getDomXPath <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>el<span class=\"token punctuation\">:</span> HTMLElement<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token parameter\"><span class=\"token builtin\">string</span></span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> curXPath <span class=\"token operator\">=</span> <span class=\"token string\">''</span>\n  <span class=\"token keyword\">const</span> tagName <span class=\"token operator\">=</span> el<span class=\"token punctuation\">.</span>tagName<span class=\"token punctuation\">.</span><span class=\"token function\">toLowerCase</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>tagName <span class=\"token operator\">===</span> <span class=\"token string\">'body'</span> <span class=\"token operator\">||</span> tagName <span class=\"token operator\">===</span> <span class=\"token string\">'html'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> tagName\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">let</span> id <span class=\"token operator\">=</span> el<span class=\"token punctuation\">.</span>id\n  <span class=\"token keyword\">let</span> elIndex <span class=\"token operator\">=</span> <span class=\"token class-name\">Array</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">.</span><span class=\"token function\">call</span><span class=\"token punctuation\">(</span>el<span class=\"token punctuation\">.</span>parentElement<span class=\"token punctuation\">.</span>children<span class=\"token punctuation\">,</span> el<span class=\"token punctuation\">)</span>\n  curXPath <span class=\"token operator\">=</span> id <span class=\"token operator\">?</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>tagName<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">[@id=</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>id<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">]</span><span class=\"token template-punctuation string\">`</span></span> <span class=\"token punctuation\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>tagName<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">[</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>elIndex<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">]</span><span class=\"token template-punctuation string\">`</span></span>\n\n  <span class=\"token keyword\">const</span> parentXpath <span class=\"token operator\">=</span> <span class=\"token function\">getDomXPath</span><span class=\"token punctuation\">(</span>el<span class=\"token punctuation\">.</span>parentElement<span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>parentXpath<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\\\\</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>curXPath<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token comment\">/**\n * 获取某个dom的css选择器路径\n * @param target dom节点\n */</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> getDomCssPath <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>el<span class=\"token punctuation\">:</span> HTMLElement<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token parameter\"><span class=\"token builtin\">string</span></span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> cssPath <span class=\"token operator\">=</span> <span class=\"token string\">''</span>\n  <span class=\"token keyword\">const</span> tagName <span class=\"token operator\">=</span> el<span class=\"token punctuation\">.</span>tagName<span class=\"token punctuation\">.</span><span class=\"token function\">toLowerCase</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>tagName <span class=\"token operator\">===</span> <span class=\"token string\">'body'</span> <span class=\"token operator\">||</span> tagName <span class=\"token operator\">===</span> <span class=\"token string\">'html'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> tagName\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">let</span> id <span class=\"token operator\">=</span> el<span class=\"token punctuation\">.</span>id\n  <span class=\"token keyword\">let</span> elClsList <span class=\"token operator\">=</span> <span class=\"token class-name\">Array</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">.</span><span class=\"token function\">call</span><span class=\"token punctuation\">(</span>el<span class=\"token punctuation\">.</span>classList<span class=\"token punctuation\">,</span> <span class=\"token string\">'.'</span><span class=\"token punctuation\">)</span>\n  cssPath <span class=\"token operator\">=</span> id <span class=\"token operator\">?</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>tagName<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">#</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>id<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span> <span class=\"token punctuation\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>tagName<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">.</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>elClsList<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span>\n\n  <span class=\"token keyword\">const</span> parentCssPath <span class=\"token operator\">=</span> <span class=\"token function\">getDomCssPath</span><span class=\"token punctuation\">(</span>el<span class=\"token punctuation\">.</span>parentElement<span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>parentCssPath<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">></span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>cssPath<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span>\n<span class=\"token punctuation\">}</span></code></pre></div>","frontmatter":{"title":"xpath和css selector实现","date":"November 21, 2019","description":"实现xpath和css selector"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/xpath实现/","previous":{"fields":{"slug":"/next-tick/"},"frontmatter":{"title":"vue.nextTick 原理解析"}},"next":{"fields":{"slug":"/the-art-of-command-line/"},"frontmatter":{"title":"the art of cammand line"}}}}}